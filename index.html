<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SMPS Tech | NEO Command Portal</title>
    <!-- Premium Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">
    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <!-- PDF.js for secure PDF viewing -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>
    <!-- 3D Engine -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Anime.js for smooth animations -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>

    <style>
        /* Theme Variables - Light & Dark Modes - Aesthetic Theme */
        :root {
            /* Light Mode - Bright & Clean */
            --primary-light: #6366F1;
            --primary-dark: #4F46E5;
            --primary-soft: #818CF8;
            --primary-glow: rgba(99, 102, 241, 0.25);
            --bg-light: #F9FAFB;
            --bg-dark: #111827;
            --surface-light: #FFFFFF;
            --surface-dark: #1F2937;
            --text-light: #1F2937;
            --text-dark: #F3F4F6;
            --text-muted-light: #6B7280;
            --text-muted-dark: #9CA3AF;
            --border-light: #E5E7EB;
            --border-dark: #374151;
            --card-bg-light: #FFFFFF;
            --card-bg-dark: #1F2937;
            --sidebar-bg-light: rgba(255, 255, 255, 0.95);
            --sidebar-bg-dark: rgba(17, 24, 39, 0.98);
            --hover-light: #F3F4F6;
            --hover-dark: #374151;
            --success: #10B981;
            --warning: #F59E0B;
            --danger: #EF4444;
            --info: #3B82F6;
            --accent-1: #8B5CF6;
            --accent-2: #EC4899;

            /* Current theme (default light) */
            --primary: var(--primary-light);
            --bg: var(--bg-light);
            --surface: var(--surface-light);
            --text: var(--text-light);
            --text-muted: var(--text-muted-light);
            --border: var(--border-light);
            --card-bg: var(--card-bg-light);
            --sidebar-bg: var(--sidebar-bg-light);
            --hover-bg: var(--hover-light);

            /* Shadows */
            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
            --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1);
            --shadow-xl: 0 20px 25px -5px rgb(0 0 0 / 0.1);
        }

        /* Dark Mode */
        [data-theme="dark"] {
            --primary: var(--primary-light);
            --bg: #111827;
            --surface: #1F2937;
            --text: #F3F4F6;
            --text-muted: #9CA3AF;
            --border: #374151;
            --card-bg: #1F2937;
            --sidebar-bg: rgba(17, 24, 39, 0.98);
            --hover-bg: #374151;

            /* Shadows for dark mode */
            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.3);
            --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.4);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.4);
            --shadow-xl: 0 20px 25px -5px rgb(0 0 0 / 0.5);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            outline: none;
        }

        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background: var(--bg);
            color: var(--text);
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
            min-height: 100vh;
            transition: background-color 0.3s, color 0.3s;
        }

        /* 3D Visual Layer */
        #canvas-container {
            position: fixed;
            inset: 0;
            z-index: -1;
            background: radial-gradient(circle at 30% 40%, var(--bg), var(--surface));
            opacity: 0.6;
        }

        /* Theme Toggle Button - Aesthetic */
        .theme-toggle {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 60px;
            padding: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 4px;
            color: var(--text);
            transition: 0.3s;
            margin-left: 15px;
            box-shadow: var(--shadow-md);
        }

        .theme-toggle:hover {
            border-color: var(--primary);
            box-shadow: 0 0 0 4px var(--primary-glow);
            transform: scale(1.05);
        }

        .theme-toggle i {
            font-size: 1.2rem;
            padding: 6px 10px;
            border-radius: 40px;
            transition: 0.3s;
        }

        .theme-toggle .fa-sun {
            color: #F59E0B;
        }

        .theme-toggle .fa-moon {
            color: #6366F1;
        }

        [data-theme="light"] .theme-toggle .fa-sun {
            background: rgba(245, 158, 11, 0.15);
        }

        [data-theme="dark"] .theme-toggle .fa-moon {
            background: rgba(99, 102, 241, 0.15);
        }

        /* Status Ticker */
        .ticker-wrap {
            position: fixed;
            top: 0;
            width: 100%;
            height: 44px;
            background: var(--surface);
            backdrop-filter: blur(12px);
            color: var(--text);
            z-index: 1100;
            display: flex;
            align-items: center;
            overflow: hidden;
            font-size: 11px;
            font-weight: 700;
            border-bottom: 1px solid var(--border);
            letter-spacing: 0.5px;
            box-shadow: var(--shadow-md);
        }

        .ticker-move {
            display: flex;
            white-space: nowrap;
            animation: ticker-scroll 60s linear infinite;
            gap: 4rem;
        }

        .ticker-move span i {
            color: var(--primary);
            margin-right: 8px;
        }

        @keyframes ticker-scroll {
            0% {
                transform: translateX(100%);
            }

            100% {
                transform: translateX(-100%);
            }
        }

        /* Floating Navigation bar - Aesthetic */
        #top-nav {
            position: fixed;
            top: 44px;
            width: 92%;
            left: 4%;
            height: 80px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 40px;
            z-index: 1000;
            background: var(--sidebar-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--border);
            border-radius: 100px;
            margin-top: 10px;
            box-shadow: var(--shadow-xl);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        #top-nav.scrolled {
            margin-top: 0;
            width: 100%;
            left: 0;
            border-radius: 0;
            border-left: none;
            border-right: none;
            border-top: none;
            box-shadow: var(--shadow-lg);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            font-weight: 800;
            font-size: 1.5rem;
            letter-spacing: -0.5px;
            color: var(--text);
        }

        .logo img {
            height: 45px;
            width: auto;
            border-radius: 12px;
            object-fit: contain;
        }

        .logo i {
            color: var(--primary);
            font-size: 2rem;
            filter: drop-shadow(0 4px 6px var(--primary-glow));
        }

        .nav-controls {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .btn-minimal {
            background: linear-gradient(135deg, var(--primary), var(--accent-1));
            border: none;
            padding: 14px 40px;
            border-radius: 60px;
            font-weight: 700;
            font-size: 13px;
            color: #fff;
            cursor: pointer;
            text-transform: uppercase;
            transition: 0.3s;
            letter-spacing: 1px;
            box-shadow: 0 10px 20px var(--primary-glow);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .btn-minimal:hover {
            transform: translateY(-3px) scale(1.02);
            box-shadow: 0 20px 30px var(--primary-glow);
        }

        #mobile-menu-btn {
            display: none;
            background: linear-gradient(135deg, var(--primary), var(--accent-1));
            color: white;
            border: none;
            width: 60px;
            height: 60px;
            border-radius: 30px;
            font-size: 1.4rem;
            cursor: pointer;
            z-index: 2000;
            position: fixed;
            bottom: 25px;
            right: 25px;
            box-shadow: 0 10px 25px var(--primary-glow);
            border: 2px solid rgba(255, 255, 255, 0.2);
        }

        /* --- HOME PAGE --- */
        #view-home {
            padding-top: 150px;
            min-height: 100vh;
            overflow-y: auto;
            position: relative;
            z-index: 10;
        }

        .hero {
            display: grid;
            grid-template-columns: 1.2fr 1fr;
            align-items: center;
            padding: 60px 120px;
            max-width: 1600px;
            margin: 0 auto;
        }

        .hero-text h1 {
            font-size: 6rem;
            font-weight: 800;
            line-height: 1;
            letter-spacing: -3px;
            margin-bottom: 30px;
            background: linear-gradient(135deg, var(--text), var(--primary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .hero-text p {
            font-size: 1.2rem;
            color: var(--text-muted);
            line-height: 1.8;
            margin-bottom: 40px;
            max-width: 600px;
            font-weight: 500;
        }

        .wall-of-fame {
            padding: 60px 120px 120px;
            max-width: 1600px;
            margin: 0 auto;
        }

        .wall-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
            margin-top: 50px;
        }

        .wall-card {
            padding: 50px 40px;
            background: var(--card-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--border);
            border-radius: 40px;
            text-align: center;
            transition: 0.5s cubic-bezier(0.2, 0.8, 0.2, 1);
            box-shadow: var(--shadow-lg);
        }

        .wall-card:hover {
            border-color: var(--primary);
            transform: translateY(-15px) scale(1.02);
            box-shadow: 0 30px 50px var(--primary-glow);
        }

        .wall-card i {
            font-size: 3.5rem;
            background: linear-gradient(135deg, var(--warning), var(--accent-2));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 25px;
        }

        .wall-card h4 {
            color: var(--text);
            font-size: 1.8rem;
            margin-bottom: 10px;
        }

        .wall-card p {
            color: var(--text-muted);
        }

        /* Developer Credit Section - HIGHLIGHTED */
        .credit-section {
            text-align: center;
            padding: 40px 20px 60px;
            max-width: 1600px;
            margin: 0 auto;
            border-top: 1px solid var(--border);
        }

        .credit-content {
            display: inline-block;
            padding: 25px 50px;
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.1), rgba(139, 92, 246, 0.1));
            border-radius: 60px;
            border: 2px solid var(--primary);
            box-shadow: 0 0 30px var(--primary-glow);
            backdrop-filter: blur(10px);
        }

        .credit-content p {
            font-size: 1.2rem;
            color: var(--text);
            font-weight: 600;
        }

        .credit-content a {
            color: var(--primary);
            text-decoration: none;
            font-weight: 800;
            font-size: 1.4rem;
            border-bottom: 3px solid var(--accent-2);
            padding-bottom: 2px;
            transition: 0.3s;
            background: linear-gradient(135deg, var(--primary), var(--accent-2));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            display: inline-block;
        }

        .credit-content a:hover {
            transform: scale(1.05);
            border-bottom-color: var(--primary);
        }

        .credit-content i {
            color: var(--warning);
            filter: drop-shadow(0 0 10px var(--warning));
        }

        /* --- PORTAL CORE LAYOUT --- */
        #view-portal {
            display: flex;
            height: 100vh;
            margin-top: 44px;
            height: calc(100vh - 44px);
            position: relative;
            z-index: 100;
            overflow: hidden;
        }

        .sidebar {
            width: 300px;
            padding: 40px 25px;
            background: var(--sidebar-bg);
            backdrop-filter: blur(30px);
            border-right: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            flex-shrink: 0;
            height: 100%;
            transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 10px 0 30px rgba(0, 0, 0, 0.05);
        }

        .sidebar-link {
            padding: 16px 20px;
            border-radius: 16px;
            color: var(--text-muted);
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 14px;
            cursor: pointer;
            transition: 0.3s;
            margin-bottom: 6px;
            font-size: 0.95rem;
            border: 1px solid transparent;
        }

        .sidebar-link:hover {
            color: var(--text);
            background: var(--hover-bg);
            border-color: var(--border);
        }

        .sidebar-link.active {
            background: linear-gradient(135deg, var(--primary), var(--accent-1));
            color: #fff;
            box-shadow: 0 10px 20px var(--primary-glow);
        }

        .profile-stack {
            margin-top: auto;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .profile-card {
            padding: 20px;
            background: var(--surface);
            border-radius: 24px;
            border: 1px solid var(--border);
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .avatar-circle {
            width: 55px;
            height: 55px;
            background: linear-gradient(135deg, var(--primary), var(--accent-1));
            color: #fff;
            border-radius: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            flex-shrink: 0;
            font-size: 1.4rem;
            box-shadow: 0 10px 20px var(--primary-glow);
        }

        .profile-info h4 {
            color: var(--text);
            font-size: 1.1rem;
            margin-bottom: 5px;
        }

        .profile-info p {
            color: var(--text-muted);
            font-size: 0.85rem;
            font-weight: 500;
        }

        .btn-terminate {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.2) !important;
            color: #EF4444 !important;
            padding: 16px !important;
            border-radius: 24px !important;
            font-weight: 700 !important;
            font-size: 11px !important;
            transition: 0.3s !important;
        }

        .btn-terminate:hover {
            background: rgba(239, 68, 68, 0.15) !important;
            border-color: #EF4444 !important;
        }

        .workspace {
            flex: 1;
            padding: 40px;
            overflow-y: auto;
            background: var(--bg);
        }

        /* Grid Layouts - Aesthetic */
        .bento-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 24px;
            margin-bottom: 30px;
        }

        .card {
            padding: 28px;
            border-radius: 32px;
            background: var(--card-bg);
            border: 1px solid var(--border);
            transition: 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: var(--shadow-md);
        }

        .card:hover {
            transform: translateY(-6px);
            border-color: var(--primary);
            box-shadow: var(--shadow-xl);
        }

        .info-label {
            font-size: 10px;
            font-weight: 700;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 12px;
            display: block;
        }

        .info-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text);
            line-height: 1.2;
            letter-spacing: -0.5px;
        }

        .info-sub {
            color: var(--text-muted);
            font-size: 0.9rem;
            margin-top: 5px;
        }

        /* Attendance Card */
        .presence-card {
            grid-column: span 2;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-left: 6px solid var(--primary);
        }

        .btn-claim {
            padding: 14px 28px;
            border-radius: 40px;
            border: none;
            background: linear-gradient(135deg, var(--primary), var(--accent-1));
            color: #fff;
            font-weight: 600;
            text-transform: uppercase;
            cursor: pointer;
            font-size: 11px;
            transition: 0.3s;
            box-shadow: 0 8px 16px var(--primary-glow);
            letter-spacing: 0.5px;
        }

        .btn-claim:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 25px var(--primary-glow);
        }

        .stats-ring {
            width: 130px;
            height: 130px;
            margin: 0 auto;
            position: relative;
        }

        .stats-count {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-weight: 700;
            font-size: 1.8rem;
            color: var(--text);
        }

        .matrix-container {
            display: grid;
            grid-template-columns: repeat(15, 1fr);
            gap: 4px;
            margin-top: 15px;
        }

        .matrix-node {
            width: 100%;
            aspect-ratio: 1;
            border-radius: 4px;
            background: var(--hover-bg);
            border: 1px solid var(--border);
            transition: 0.3s;
        }

        .matrix-node.verified {
            background: var(--success);
            border-color: var(--success);
            box-shadow: 0 0 10px rgba(16, 185, 129, 0.3);
        }

        .matrix-node.missed {
            background: var(--danger);
            border-color: var(--danger);
            box-shadow: 0 0 10px rgba(239, 68, 68, 0.3);
        }

        /* Project Dashboard - Dynamic Points - EXACT number of boxes */
        .proj-dash-container {
            display: flex;
            flex-direction: column;
            gap: 30px;
        }

        .proj-dash-grid {
            display: grid;
            grid-template-columns: 1.5fr 1fr;
            gap: 30px;
        }

        @media (max-width: 1200px) {
            .proj-dash-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Dynamic milestone grid - adapts to point count */
        .milestone-grid {
            display: grid;
            grid-template-columns: repeat(10, 1fr);
            gap: 8px;
            margin-top: 20px;
        }

        .milestone-node {
            aspect-ratio: 1;
            border-radius: 12px;
            border: 2px solid var(--border);
            cursor: pointer;
            transition: 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            background: var(--surface);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 11px;
            font-weight: 600;
            color: var(--text);
        }

        .milestone-node.pending {
            background: var(--warning);
            border-color: var(--warning);
            color: white;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% {
                opacity: 1;
            }

            50% {
                opacity: 0.7;
            }

            100% {
                opacity: 1;
            }
        }

        .milestone-node.approved {
            background: var(--success);
            border-color: var(--success);
            color: white;
            box-shadow: 0 0 15px rgba(16, 185, 129, 0.5);
        }

        .milestone-node:hover {
            border-color: var(--primary);
            transform: scale(1.1) rotate(2deg);
            z-index: 10;
            box-shadow: 0 10px 20px var(--primary-glow);
        }

        /* PDF viewer placeholder */
        .pdf-viewer-placeholder {
            width: 100%;
            height: 350px;
            border-radius: 24px;
            border: 1px dashed var(--border);
            background: var(--hover-bg);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin-top: 15px;
            cursor: pointer;
            transition: 0.3s;
        }

        .pdf-viewer-placeholder:hover {
            border-color: var(--primary);
            background: var(--surface);
        }

        .pdf-viewer-node {
            width: 100%;
            height: 500px;
            border-radius: 24px;
            border: 1px solid var(--border);
            background: var(--surface);
        }

        .input-group {
            display: flex;
            gap: 12px;
            margin-top: 15px;
        }

        .input-group input {
            flex: 1;
            padding: 16px 22px;
            border-radius: 40px;
            border: 2px solid var(--border);
            background: var(--surface);
            color: var(--text);
            font-weight: 500;
            transition: 0.3s;
        }

        .input-group input:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 4px var(--primary-glow);
        }

        .btn-action {
            padding: 16px 32px;
            border-radius: 40px;
            border: none;
            background: linear-gradient(135deg, var(--primary), var(--accent-1));
            color: white;
            font-weight: 600;
            font-size: 11px;
            text-transform: uppercase;
            cursor: pointer;
            letter-spacing: 0.5px;
            box-shadow: 0 8px 16px var(--primary-glow);
        }

        /* Chat Hub */
        .chat-hub {
            display: grid;
            grid-template-columns: 280px 1fr;
            height: calc(100vh - 180px);
            background: var(--card-bg);
            border-radius: 40px;
            overflow: hidden;
            border: 1px solid var(--border);
            box-shadow: var(--shadow-xl);
        }

        .chat-nav {
            background: var(--surface);
            border-right: 1px solid var(--border);
            padding: 25px 15px;
            overflow-y: auto;
        }

        .chat-list-item {
            padding: 16px 18px;
            border-radius: 20px;
            margin-bottom: 8px;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 12px;
            transition: 0.3s;
            color: var(--text-muted);
            border: 1px solid transparent;
        }

        .chat-list-item:hover {
            background: var(--hover-bg);
            color: var(--text);
            border-color: var(--border);
        }

        .chat-list-item.active {
            background: linear-gradient(135deg, var(--primary), var(--accent-1));
            color: white;
        }

        .chat-history {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 20px;
            background: var(--bg);
        }

        .bubble {
            font-size: 0.95rem;
            font-weight: 500;
            padding: 16px 22px;
            border-radius: 24px;
            max-width: 70%;
            line-height: 1.6;
            animation: bubble-entry 0.3s ease-out forwards;
        }

        @keyframes bubble-entry {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .bubble-me {
            align-self: flex-end;
            background: linear-gradient(135deg, var(--primary), var(--accent-1));
            color: #fff;
            border-bottom-right-radius: 8px;
        }

        .bubble-them {
            align-self: flex-start;
            background: var(--surface);
            border: 1px solid var(--border);
            border-bottom-left-radius: 8px;
            color: var(--text);
        }

        .bubble-time {
            font-size: 9px;
            margin-top: 8px;
            opacity: 0.7;
            display: block;
            text-align: right;
        }

        .chat-input-pill {
            flex: 1;
            padding: 18px 28px;
            border-radius: 50px;
            border: 2px solid var(--border);
            font-weight: 500;
            background: var(--surface);
            color: var(--text);
            font-size: 0.95rem;
            transition: 0.3s;
        }

        .chat-input-pill:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 4px var(--primary-glow);
        }

        /* Calendar */
        .att-calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 6px;
            margin-top: 20px;
        }

        .calendar-header {
            text-align: center;
            font-weight: 700;
            color: var(--text-muted);
            font-size: 11px;
            padding: 8px;
        }

        .calendar-cell {
            aspect-ratio: 1;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 14px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: 600;
            color: var(--text);
            position: relative;
        }

        .calendar-cell.today {
            border: 2px solid var(--primary);
        }

        .status-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            margin-top: 4px;
        }

        .status-dot.status-present {
            background: var(--success);
        }

        .status-dot.status-absent {
            background: var(--danger);
        }

        /* Task Cards */
        .task-card {
            padding: 28px;
            border-radius: 32px;
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-left-width: 6px;
            transition: 0.3s;
            box-shadow: var(--shadow-md);
        }

        .task-card:hover {
            transform: translateY(-5px);
            border-color: var(--primary);
            box-shadow: var(--shadow-xl);
        }

        /* Notifications */
        .notif-card {
            padding: 22px;
            border-radius: 24px;
            background: var(--card-bg);
            border: 1px solid var(--border);
            display: flex;
            gap: 18px;
            align-items: center;
            transition: 0.3s;
            margin-bottom: 12px;
        }

        .notif-card:hover {
            transform: translateX(6px);
            border-color: var(--primary);
            box-shadow: var(--shadow-md);
        }

        .notif-icon {
            width: 55px;
            height: 55px;
            border-radius: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            font-size: 1.4rem;
            background: var(--surface);
        }

        /* Resource Cards and Grid Styles - Enhanced for better visibility */
        .resource-category {
            margin-bottom: 40px;
        }

        .resource-category h3 {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .resource-category h3 i {
            color: var(--primary);
        }

        .resource-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .resource-card {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 24px;
            padding: 20px;
            transition: 0.3s;
            cursor: pointer;
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .resource-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary), var(--accent-1));
            opacity: 0;
            transition: 0.3s;
        }

        .resource-card:hover::before {
            opacity: 1;
        }

        .resource-card:hover {
            transform: translateY(-5px);
            border-color: var(--primary);
            box-shadow: var(--shadow-lg);
        }

        .resource-icon {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, var(--primary), var(--accent-1));
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
            margin-bottom: 5px;
        }

        .resource-title {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--text);
            margin-bottom: 5px;
        }

        .resource-description {
            font-size: 0.9rem;
            color: var(--text-muted);
            margin-bottom: 10px;
        }

        .resource-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 11px;
            color: var(--text-muted);
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid var(--border);
        }

        .resource-tag {
            background: var(--hover-bg);
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 10px;
            font-weight: 600;
            color: var(--primary);
            border: 1px solid var(--primary);
        }

        .resource-uploader {
            display: flex;
            align-items: center;
            gap: 5px;
            font-weight: 600;
        }

        .resource-uploader i {
            color: var(--primary);
        }

        .resource-uploader span {
            color: var(--accent-2);
            font-weight: 700;
        }

        /* Enhanced PDF Viewer Modal - Secure View */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.95);
            backdrop-filter: blur(10px);
            z-index: 10000;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            visibility: hidden;
            transition: 0.3s;
        }

        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            width: 95%;
            max-width: 1400px;
            height: 95vh;
            background: var(--surface);
            border-radius: 40px;
            border: 1px solid var(--border);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            transform: scale(0.9);
            transition: 0.3s;
        }

        .modal-overlay.active .modal-content {
            transform: scale(1);
        }

        .modal-header {
            padding: 20px 30px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: var(--surface);
        }

        .modal-header h3 {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text);
        }

        .modal-controls {
            display: flex;
            gap: 10px;
        }

        .modal-close {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--hover-bg);
            border: 1px solid var(--border);
            color: var(--text);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: 0.3s;
        }

        .modal-close:hover {
            background: var(--danger);
            color: white;
            border-color: var(--danger);
        }

        .modal-body {
            flex: 1;
            padding: 20px;
            overflow: auto;
            background: #525659;
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
        }

        #pdf-canvas-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            position: relative;
        }

        .pdf-page {
            background: white;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            overflow: hidden;
            position: relative;
            z-index: 2;
        }

        .pdf-controls {
            display: flex;
            gap: 15px;
            align-items: center;
            padding: 15px;
            background: var(--surface);
            border-radius: 50px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            justify-content: center;
            position: sticky;
            top: 10px;
            z-index: 100;
            box-shadow: var(--shadow-lg);
        }

        .pdf-controls button {
            padding: 10px 20px;
            border-radius: 30px;
            border: none;
            background: var(--primary);
            color: white;
            cursor: pointer;
            font-weight: 600;
            font-size: 12px;
            transition: 0.3s;
        }

        .pdf-controls button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px var(--primary-glow);
        }

        .pdf-controls button:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        .pdf-controls span {
            font-weight: 600;
            color: var(--text);
        }

        .hidden {
            display: none !important;
        }

        #loader {
            position: fixed;
            inset: 0;
            background: var(--bg);
            z-index: 10000;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            gap: 20px;
        }

        .loader-text {
            color: var(--text);
            font-weight: 600;
            font-size: 14px;
            letter-spacing: 2px;
            margin-top: 20px;
        }

        .spinner {
            width: 60px;
            height: 60px;
            border: 4px solid var(--border);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 0.8s cubic-bezier(0.4, 0, 0.2, 1) infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        /* Aesthetic Badges */
        .badge-aesthetic {
            display: inline-block;
            padding: 6px 14px;
            border-radius: 40px;
            font-size: 11px;
            font-weight: 600;
            background: linear-gradient(135deg, var(--primary), var(--accent-1));
            color: white;
            box-shadow: 0 4px 10px var(--primary-glow);
        }

        /* Progress Bar */
        .progress-track {
            height: 10px;
            background: var(--border);
            border-radius: 20px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--success), #34D399);
            border-radius: 20px;
            transition: width 0.5s ease;
        }

        /* Score Display */
        .score-display {
            font-size: 2rem;
            font-weight: 800;
            color: var(--primary);
            text-align: center;
        }

        .score-label {
            font-size: 11px;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* Portal Credit Footer - HIGHLIGHTED */
        .portal-credit {
            text-align: center;
            padding: 20px;
            margin-top: 30px;
            border-top: 1px solid var(--border);
            font-size: 0.9rem;
            color: var(--text-muted);
        }

        .portal-credit a {
            color: var(--primary);
            text-decoration: none;
            font-weight: 800;
            font-size: 1.1rem;
            border-bottom: 2px solid var(--accent-2);
            padding: 0 5px;
            background: linear-gradient(135deg, var(--primary), var(--accent-2));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            display: inline-block;
        }

        .portal-credit i {
            color: var(--warning);
            filter: drop-shadow(0 0 5px var(--warning));
        }

        /* Responsive Design */
        @media screen and (max-width: 768px) {
            #view-portal {
                flex-direction: column;
                margin-top: 44px;
                height: calc(100vh - 44px);
            }

            .sidebar {
                position: fixed;
                left: 0;
                top: 44px;
                height: calc(100vh - 44px);
                z-index: 1000;
                transform: translateX(-100%);
                width: 85%;
            }

            .sidebar.active {
                transform: translateX(0);
            }

            .workspace {
                padding: 25px;
            }

            .bento-grid {
                grid-template-columns: 1fr;
            }

            .chat-hub {
                grid-template-columns: 1fr;
            }

            .chat-nav {
                display: flex;
                flex-direction: row;
                height: 80px;
                border-right: none;
                border-bottom: 1px solid var(--border);
                padding: 10px;
                white-space: nowrap;
                overflow-x: auto;
                gap: 10px;
            }

            #mobile-menu-btn {
                display: block;
            }

            .hero {
                grid-template-columns: 1fr;
                padding: 40px 25px;
                text-align: center;
            }

            .hero-text h1 {
                font-size: 4rem;
                letter-spacing: -2px;
            }

            .hero-text p {
                margin: 0 auto 40px;
            }

            .wall-of-fame {
                padding: 40px 25px;
            }

            .wall-grid {
                grid-template-columns: 1fr;
            }

            .presence-card {
                flex-direction: column;
                gap: 20px;
                text-align: center;
            }

            .presence-card>div:last-child {
                border-left: none;
                border-top: 1px solid var(--border);
                padding-left: 0;
                padding-top: 20px;
            }

            .resource-grid {
                grid-template-columns: 1fr;
            }

            .pdf-controls {
                flex-wrap: wrap;
                justify-content: center;
            }

            .credit-content {
                padding: 15px 25px;
            }

            .credit-content p {
                font-size: 1rem;
            }

            .credit-content a {
                font-size: 1.2rem;
            }
        }
    </style>
</head>

<body data-theme="light">

    <div id="canvas-container"></div>

    <div id="loader">
        <div class="spinner"></div>
        <div class="loader-text">INITIALIZING NEO COMMAND</div>
    </div>

    <button id="mobile-menu-btn" onclick="App.toggleSidebar()"><i class="fas fa-bars"></i></button>

    <div id="ticker-bar" class="ticker-wrap hidden">
        <div class="ticker-move">
            <span><i class="fas fa-bolt"></i> NEO SYSTEM: QUANTUM NODE SYNC ACTIVE</span>
            <span><i class="fas fa-microchip"></i> TRACK PROGRESS: DYNAMIC POINT SCALE CALIBRATED</span>
            <span><i class="fas fa-file-pdf"></i> PROTOCOL: MENTOR PDF UPLOADS NOW VISIBLE</span>
            <span><i class="fas fa-shield"></i> SECURITY: END-TO-END ENCRYPTION ENABLED</span>
            <span><i class="fas fa-crown"></i> ARCHITECT: <span style="color: var(--warning); font-weight: 800;">SHIVA
                    BHALKE</span></span>
        </div>
    </div>

    <!-- Secure PDF Viewer Modal with PDF.js -->
    <div id="pdf-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modal-title">Technical Protocol Viewer</h3>
                <div class="modal-controls">
                    <button class="modal-close" onclick="App.closePDFModal()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>
            <div class="modal-body">
                <div class="pdf-controls">
                    <button onclick="App.prevPage()" id="prev-page" disabled>
                        <i class="fas fa-chevron-left"></i> Previous
                    </button>
                    <span>Page <span id="page-num">1</span> / <span id="page-count">1</span></span>
                    <button onclick="App.nextPage()" id="next-page" disabled>
                        Next <i class="fas fa-chevron-right"></i>
                    </button>
                    <button onclick="App.zoomIn()">
                        <i class="fas fa-search-plus"></i> Zoom In
                    </button>
                    <button onclick="App.zoomOut()">
                        <i class="fas fa-search-minus"></i> Zoom Out
                    </button>
                    <button onclick="App.fitToWidth()">
                        <i class="fas fa-arrows-alt-h"></i> Fit Width
                    </button>
                </div>
                <div id="pdf-canvas-container">
                    <canvas id="pdf-canvas" class="pdf-page"></canvas>
                </div>
                <div id="pdf-loading" class="spinner" style="display: none;"></div>
            </div>
        </div>
    </div>

    <!-- Navigation with Theme Toggle and Logo Image -->
    <nav id="top-nav" class="hidden">
        <div class="logo">
            <img src="smps-logo.png" alt="SMPS"
                onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
            <i class="fas fa-shield-halved" style="display: none;"></i>
            <span>SMPS <b>NEO</b></span>
        </div>
        <div class="nav-controls">
            <div class="theme-toggle" onclick="App.toggleTheme()">
                <i class="fas fa-sun"></i>
                <i class="fas fa-moon"></i>
            </div>
            <button onclick="App.showLogin()" class="btn-minimal">Launch Portal <i class="fas fa-arrow-right"
                    style="margin-left: 10px;"></i></button>
        </div>
    </nav>

    <!-- LANDING VIEW -->
    <div id="view-home" class="hidden">
        <section class="hero">
            <div class="hero-text">
                <span class="badge-aesthetic" style="margin-bottom: 30px; display: inline-block;">
                    <i class="fas fa-crown" style="margin-right: 8px;"></i> V6.0 NEO NODE DEPLOYED
                </span>
                <h1>Command Your <br><span>Academic <br>Destiny</span></h1>
                <p>Quantum-powered research portal for elite students. Track projects, sync with mentors, and visualize
                    your technical journey in real-time.</p>
                <button onclick="App.showLogin()" class="btn-minimal"
                    style="padding: 22px 60px; border-radius: 60px; font-size: 14px;">
                    INITIALIZE WORKSPACE <i class="fas fa-arrow-right" style="margin-left: 12px;"></i>
                </button>
            </div>
            <div></div>
        </section>

        <section class="wall-of-fame">
            <h2
                style="font-size: 3.5rem; font-weight: 700; letter-spacing: -2px; margin-bottom: 40px; color: var(--text);">
                <i class="fas fa-trophy" style="color: var(--warning); margin-right: 15px;"></i>Technical Honors
            </h2>
            <div class="wall-grid">
                <div class="wall-card">
                    <i class="fas fa-crown"></i>
                    <h4 class="info-value">Aryan Singh</h4>
                    <p class="info-sub">Quantum Computing Lead</p>
                    <div style="margin-top: 20px; color: var(--success); font-weight: 700;">⚡ 98/100</div>
                </div>
                <div class="wall-card">
                    <i class="fas fa-microchip"></i>
                    <h4 class="info-value">Sanjana G M</h4>
                    <p class="info-sub">Neural Network Architect</p>
                    <div style="margin-top: 20px; color: var(--success); font-weight: 700;">⚡ 96/100</div>
                </div>
                <div class="wall-card">
                    <i class="fas fa-flask"></i>
                    <h4 class="info-value">Varshini A R</h4>
                    <p class="info-sub">Research Excellence</p>
                    <div style="margin-top: 20px; color: var(--success); font-weight: 700;">⚡ 95/100</div>
                </div>
            </div>
        </section>

        <!-- Developer Credit Section - HIGHLIGHTED -->
        <div class="credit-section">
            <div class="credit-content">
                <p><i class="fas fa-crown" style="color: var(--warning); margin-right: 8px;"></i> Platform Architecture
                    & Development by <a href="https://www.shivabhalke.life/" target="_blank"><b>SHIVA BHALKE</b></a> <i
                        class="fas fa-bolt" style="color: var(--primary); margin-left: 8px;"></i></p>
                <p style="font-size: 0.9rem; margin-top: 10px; color: var(--text-muted);">NEO Command · Mentor-Student
                    Sync · Quantum Research Portal</p>
            </div>
        </div>
    </div>

    <!-- LOGIN SCREEN -->
    <div id="view-login" class="hidden"
        style="height: 100vh; display: flex; align-items: center; justify-content: center;">
        <div class="card" style="max-width: 500px; width: 92%; padding: 50px; border-radius: 50px;">
            <button onclick="App.showHome()"
                style="background:none; border:none; color: var(--text-muted); cursor:pointer; margin-bottom: 35px; font-weight:600; font-size:12px; letter-spacing:1px; display:flex; align-items:center; gap:8px;">
                <i class="fas fa-arrow-left"></i> RETURN TO TERMINAL
            </button>
            <div style="text-align: center; margin-bottom: 40px;">
                <div style="font-size: 3rem; color: var(--primary); margin-bottom: 20px;"><i
                        class="fas fa-fingerprint"></i></div>
                <h2 style="font-weight: 700; letter-spacing: -1px; font-size: 2.8rem; color: var(--text);">Identify</h2>
                <p class="info-label">Authorized Academic Access Required</p>
            </div>
            <form id="login-form">
                <div style="margin-bottom: 20px;">
                    <label class="info-label">Identity Token (SRN)</label>
                    <input type="text" id="l-srn"
                        style="width:100%; padding: 18px; border-radius: 40px; border: 2px solid var(--border); background:var(--surface); color:var(--text); font-weight:500; font-size:1rem; transition:0.3s;"
                        placeholder="SRN..." required>
                </div>
                <div style="margin-bottom: 35px;">
                    <label class="info-label">Authorization Key</label>
                    <input type="password" id="l-pass"
                        style="width:100%; padding: 18px; border-radius: 40px; border: 2px solid var(--border); background:var(--surface); color:var(--text); font-weight:500; font-size:1rem; transition:0.3s;"
                        placeholder="••••••••" required>
                </div>
                <button type="submit" class="btn-claim" style="width:100%; height: 65px; font-size: 13px;">Authorize
                    Session</button>
            </form>
        </div>
    </div>

    <!-- PORTAL SHELL -->
    <div id="view-portal" class="hidden">
        <aside class="sidebar" id="app-sidebar">
            <div class="logo" style="margin-bottom: 45px; padding-left: 10px;">
                <img src="smps-logo.png" alt="SMPS"
                    onerror="this.style.display='none'; this.nextElementSibling.style.display='block';"
                    style="height: 40px;">
                <i class="fas fa-shield-halved" style="display: none;"></i>
                <span>SMPS <b>NEO</b></span>
            </div>
            <!-- Theme Toggle in Sidebar -->
            <div style="display: flex; justify-content: flex-end; margin-bottom: 20px; padding-right: 10px;">
                <div class="theme-toggle" onclick="App.toggleTheme()">
                    <i class="fas fa-sun"></i>
                    <i class="fas fa-moon"></i>
                </div>
            </div>
            <nav style="flex: 1;">
                <div onclick="App.switchTab('dashboard')" id="nav-dashboard" class="sidebar-link active">
                    <i class="fas fa-grid-2"></i> Dashboard
                </div>
                <div onclick="App.switchTab('attendance-ledger')" id="nav-attendance-ledger" class="sidebar-link">
                    <i class="fas fa-calendar-check"></i> Attendance
                </div>
                <div onclick="App.switchTab('projects')" id="nav-projects" class="sidebar-link">
                    <i class="fas fa-layer-group"></i> Project Dash
                </div>
                <div onclick="App.switchTab('tasks')" id="nav-tasks" class="sidebar-link">
                    <i class="fas fa-list-check"></i> Task Center
                </div>
                <div onclick="App.switchTab('notifications')" id="nav-notifications" class="sidebar-link">
                    <i class="fas fa-bell"></i> Notifications
                </div>
                <div onclick="App.switchTab('sync')" id="nav-sync" class="sidebar-link">
                    <i class="fas fa-message"></i> Sync Hub
                </div>
                <!-- Public Resources Link - Connected to Mentor Panel -->
                <div onclick="App.switchTab('public-resources')" id="nav-public-resources" class="sidebar-link">
                    <i class="fas fa-book-open"></i> Public Resources
                </div>
            </nav>
            <div class="profile-stack">
                <div class="profile-card">
                    <div id="u-avatar" class="avatar-circle">?</div>
                    <div class="profile-info">
                        <h4 id="u-name-side">---</h4>
                        <p id="u-srn-side">SRN...</p>
                    </div>
                </div>
                <button onclick="location.reload()" class="btn-terminate" style="width:100%;">
                    <i class="fas fa-power-off" style="margin-right: 8px;"></i> TERMINATE SESSION
                </button>
            </div>
            <!-- Small credit in sidebar - HIGHLIGHTED -->
            <div style="margin-top: 15px; text-align: center; font-size: 10px; color: var(--text-muted);">
                <i class="fas fa-crown" style="color: var(--warning);"></i> <a href="https://www.shivabhalke.life/"
                    target="_blank"
                    style="color: var(--primary); text-decoration: none; font-weight: 800; border-bottom: 1px dashed var(--accent-2);">SHIVA
                    BHALKE</a> <i class="fas fa-bolt" style="color: var(--primary);"></i>
            </div>
        </aside>

        <main class="workspace">
            <!-- DASHBOARD TAB -->
            <div id="tab-dashboard">
                <div
                    style="display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: 30px; flex-wrap: wrap; gap: 15px;">
                    <div>
                        <h2 style="font-size: 2.8rem; font-weight: 700; letter-spacing: -1.5px; color: var(--text);">
                            Command Station</h2>
                        <div id="live-time-disp"
                            style="font-size: 1.2rem; font-weight: 600; color: var(--primary); margin-top: 8px;">
                            00:00:00 AM
                        </div>
                    </div>
                    <div class="badge-aesthetic">
                        <i class="fas fa-shield"></i> QUANTUM NODE ACTIVE
                    </div>
                </div>

                <div class="bento-grid">
                    <div class="card">
                        <span class="info-label">Identity Node</span>
                        <h3 class="info-value" id="disp-name">---</h3>
                        <p class="info-sub" id="disp-details">---</p>
                    </div>
                    <div class="card">
                        <span class="info-label">Faculty Advisor</span>
                        <h3 id="d-mentor" class="info-value">---</h3>
                        <p id="d-mentor-dept" class="info-sub">---</p>
                    </div>

                    <div class="card presence-card">
                        <div class="presence-actions">
                            <span class="info-label">Presence Protocol</span>
                            <div style="display: flex; gap: 10px; margin-top: 12px; flex-wrap: wrap;">
                                <button onclick="App.markLog('IN')" class="btn-claim" style="padding: 12px 22px;">Mark
                                    Entry</button>
                                <button onclick="App.markLog('OUT')" class="btn-claim"
                                    style="background: var(--surface); color: var(--text); padding: 12px 22px;">Mark
                                    Exit</button>
                            </div>
                        </div>
                        <div style="text-align: right; border-left: 2px solid var(--border); padding-left: 25px;">
                            <span class="info-label">Status</span>
                            <div id="att-badge" style="margin-top: 8px;"></div>
                        </div>
                    </div>

                    <div class="card" style="grid-column: span 2;">
                        <div style="display: flex; gap: 35px; align-items: center; flex-wrap: wrap;">
                            <div style="flex: 1; min-width: 220px;">
                                <span class="info-label">Attendance Metrics</span>
                                <div style="margin-top: 18px; display: flex; flex-direction: column; gap: 12px;">
                                    <div
                                        style="display: flex; justify-content: space-between; font-size: 13px; font-weight: 600; color: var(--text);">
                                        <span>Cycle Yield</span>
                                        <span id="verified-count">100%</span>
                                    </div>
                                    <div class="progress-track">
                                        <div id="bar-att" class="progress-fill" style="width: 100%;">
                                        </div>
                                    </div>
                                    <div id="dash-matrix" class="matrix-container"></div>
                                </div>
                            </div>
                            <div class="stats-ring">
                                <canvas id="dashRing" width="130" height="130"></canvas>
                                <div class="stats-count" id="dash-perc">100%</div>
                            </div>
                        </div>
                    </div>

                    <div class="card" style="grid-column: span 2;">
                        <span class="info-label">Track Research Overview</span>
                        <div id="dash-projects-summary"
                            style="display: flex; flex-direction: column; gap: 12px; margin-top: 15px;"></div>
                    </div>
                </div>
            </div>

            <!-- ATTENDANCE HISTORY -->
            <div id="tab-attendance-ledger" class="hidden">
                <h2
                    style="font-size: 2.8rem; font-weight: 700; margin-bottom: 30px; letter-spacing: -1.5px; color: var(--text);">
                    <i class="fas fa-calendar-check" style="margin-right: 15px; color: var(--primary);"></i>Technical
                    Presence Ledger
                </h2>
                <div style="display: grid; grid-template-columns: 320px 1fr; gap: 30px; align-items: start;">
                    <div class="card" style="padding: 30px; height: 600px; overflow-y: auto;">
                        <span class="info-label">Daily Node Logs</span>
                        <div id="daily-log-list"
                            style="margin-top: 20px; display: flex; flex-direction: column; gap: 12px;"></div>
                    </div>
                    <div class="card">
                        <h3 class="info-value" id="cal-month-year" style="font-size: 1.8rem;">February 2026</h3>
                        <div class="att-calendar-grid" id="att-calendar"></div>
                        <div
                            style="margin-top: 40px; display: flex; gap: 30px; border-top: 1px solid var(--border); padding-top: 20px; flex-wrap: wrap;">
                            <div style="display:flex; align-items:center; gap:10px;">
                                <span class="status-dot status-present" style="width: 10px; height: 10px;"></span>
                                <span style="font-size:12px; font-weight:600; color: var(--text);">VERIFIED NODE</span>
                            </div>
                            <div style="display:flex; align-items:center; gap:10px;">
                                <span class="status-dot status-absent" style="width: 10px; height: 10px;"></span>
                                <span style="font-size:12px; font-weight:600; color: var(--text);">ABSENT /
                                    OFFLINE</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- PROJECT DASHBOARDS -->
            <div id="tab-projects" class="hidden">
                <h2
                    style="font-size: 2.8rem; font-weight: 700; margin-bottom: 30px; letter-spacing: -1.5px; color: var(--text);">
                    <i class="fas fa-microscope" style="margin-right: 15px; color: var(--primary);"></i>Technical Node
                    Dashboards
                </h2>
                <div id="projects-container" class="proj-dash-container"></div>
            </div>

            <!-- NOTIFICATIONS -->
            <div id="tab-notifications" class="hidden">
                <h2
                    style="font-size: 2.8rem; font-weight: 700; margin-bottom: 30px; letter-spacing: -1.5px; color: var(--text);">
                    <i class="fas fa-broadcast-tower"
                        style="margin-right: 15px; color: var(--primary);"></i>Transmission Broadcasts
                </h2>
                <div class="bento-grid">
                    <div class="card" style="grid-column: span 2;">
                        <span class="info-label">Mentor & Admin Alerts</span>
                        <div id="notif-faculty-pool" class="notif-lane"></div>
                    </div>
                    <div class="card" style="grid-column: span 2;">
                        <span class="info-label">Grand Command (Super Admin)</span>
                        <div id="notif-super-pool" class="notif-lane"></div>
                    </div>
                </div>
            </div>

            <!-- TASK CENTER -->
            <div id="tab-tasks" class="hidden">
                <h2
                    style="font-size: 2.8rem; font-weight: 700; margin-bottom: 30px; letter-spacing: -1.5px; color: var(--text);">
                    <i class="fas fa-clipboard-list" style="margin-right: 15px; color: var(--primary);"></i>Directive
                    Hub
                </h2>
                <div id="tasks-list" style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px;"></div>
            </div>

            <!-- SYNC HUB -->
            <div id="tab-sync" class="hidden">
                <div class="chat-hub">
                    <aside class="chat-nav" id="chat-roster"></aside>
                    <main class="chat-view" style="display: flex; flex-direction: column;">
                        <div id="chat-h"
                            style="padding: 20px 30px; border-bottom: 1px solid var(--border); font-weight: 600; color: var(--text); font-size: 1.2rem; display: flex; justify-content: space-between; align-items: center;">
                            <span id="chat-title">Select Sync Lane</span>
                            <span class="badge-aesthetic" id="chat-status" style="display:none; font-size: 10px;">SECURE
                                NODE ACTIVE</span>
                        </div>
                        <div id="chat-window" class="chat-history"></div>
                        <form id="chat-form"
                            style="padding: 20px 30px; border-top: 1px solid var(--border); display: flex; gap: 12px; background: var(--surface); align-items: center;">
                            <input type="text" id="chat-input" placeholder="Transmit technical segment..." required
                                class="chat-input-pill">
                            <button type="submit" class="btn-minimal" style="padding:0 30px; height: 55px;"><i
                                    class="fas fa-paper-plane"></i></button>
                        </form>
                    </main>
                </div>
            </div>

            <!-- PUBLIC RESOURCES TAB - Connected to Mentor Panel with DUMMY DATA -->
            <div id="tab-public-resources" class="hidden">
                <h2
                    style="font-size: 2.8rem; font-weight: 700; margin-bottom: 30px; letter-spacing: -1.5px; color: var(--text);">
                    <i class="fas fa-book-open" style="margin-right: 15px; color: var(--primary);"></i>Mentor Resource
                    Library
                </h2>

                <div class="bento-grid">
                    <div class="card" style="grid-column: span 4;">
                        <span class="info-label">FACULTY UPLOADED RESOURCES</span>
                        <div style="display: flex; gap: 15px; flex-wrap: wrap; margin-top: 20px;">
                            <button onclick="App.filterResources('all')" class="btn-claim"
                                style="background: var(--primary);" id="filter-all">All Resources</button>
                            <button onclick="App.filterResources('syllabus')" class="btn-claim"
                                style="background: var(--surface); color: var(--text);" id="filter-syllabus">Syllabus &
                                Curriculum</button>
                            <button onclick="App.filterResources('notes')" class="btn-claim"
                                style="background: var(--surface); color: var(--text);" id="filter-notes">Lecture
                                Notes</button>
                            <button onclick="App.filterResources('reference')" class="btn-claim"
                                style="background: var(--surface); color: var(--text);" id="filter-reference">Reference
                                Materials</button>
                            <button onclick="App.filterResources('pastpapers')" class="btn-claim"
                                style="background: var(--surface); color: var(--text);" id="filter-pastpapers">Past
                                Papers</button>
                        </div>
                    </div>

                    <div class="card" style="grid-column: span 4;">
                        <div class="resource-category">
                            <h3>
                                <i class="fas fa-graduation-cap"></i>
                                Academic Resources
                            </h3>
                            <div id="academic-resources" class="resource-grid">
                                <!-- Dummy data will be populated by JavaScript -->
                            </div>
                        </div>

                        <div class="resource-category">
                            <h3>
                                <i class="fas fa-code"></i>
                                Technical Documentation
                            </h3>
                            <div id="technical-resources" class="resource-grid">
                                <!-- Dummy data will be populated by JavaScript -->
                            </div>
                        </div>

                        <div class="resource-category">
                            <h3>
                                <i class="fas fa-flask"></i>
                                Research Papers & Journals
                            </h3>
                            <div id="research-resources" class="resource-grid">
                                <!-- Dummy data will be populated by JavaScript -->
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Credit in resources tab - HIGHLIGHTED -->
                <div class="portal-credit">
                    <i class="fas fa-crown" style="color: var(--warning);"></i> Platform Architecture by <a
                        href="https://www.shivabhalke.life/" target="_blank"><b>SHIVA BHALKE</b></a> <i
                        class="fas fa-bolt" style="color: var(--primary);"></i>
                </div>
            </div>
        </main>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, collection, onSnapshot, updateDoc, addDoc, serverTimestamp, query, where } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBN4o8oj-6DhJb51sGGrcyS8d9SDX7HKWk",
            authDomain: "students-management-2ec78.firebaseapp.com",
            projectId: "students-management-2ec78",
            storageBucket: "students-management-2ec78.firebasestorage.app",
            messagingSenderId: "649634574508",
            appId: "1:649634574508:web:d856dbe5bcc112fde0ef09"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        const appId = 'smps-v1';

        // Configure PDF.js
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.worker.min.js';

        const ui = {
            set: (id, val) => { const el = document.getElementById(id); if (el) el.innerText = val; },
            html: (id, val) => { const el = document.getElementById(id); if (el) el.innerHTML = val; },
            toggle: (id, isVisible) => { const el = document.getElementById(id); if (el) el.classList.toggle('hidden', !isVisible); }
        };

        // ============ DUMMY RESOURCE DATA FOR PUBLIC RESOURCES ============
        // This connects the Public Resources tab to the mentor panel with dummy data
        // ============ DUMMY RESOURCE DATA FOR PUBLIC RESOURCES ============
        // const PUBLIC_RESOURCES = {
        //     academic: [...]
        //     technical: [...]
        //     research: [...]
        // };

        // Project Resources - kept separate from public resources
        const PROJECT_RESOURCES = {
            'proj1': [{ id: 'p1r1', title: 'Quantum Algorithms - Complete Guide', pdfUrl: 'https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf', uploadedBy: 'Dr. Quantum', uploadedAt: '2024-01-22', description: 'Detailed guide' }],
            'proj2': [{ id: 'p2r1', title: 'Neural Networks from Scratch', pdfUrl: 'https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf', uploadedBy: 'Prof. Neural', uploadedAt: '2024-01-21', description: 'Basics guide' }],
            'proj3': [{ id: 'p3r1', title: 'Research Methodology - Complete Guide', pdfUrl: 'https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf', uploadedBy: 'Research Dept', uploadedAt: '2024-01-18', description: 'Research methods' }]
        };

        const App = {
            state: {
                user: null,
                projects: [],
                tasks: [],
                mentors: [],
                chats: [],
                notifications: [],
                activeChat: 'admin',
                portalTime: new Date(),
                currentResourceFilter: 'all',
                pdfDoc: null,
                currentPage: 1,
                totalPages: 1,
                scale: 1.5
            },

            async init() {
                this.init3D();
                this.startClock();

                const savedTheme = localStorage.getItem('theme') || 'light';
                document.body.setAttribute('data-theme', savedTheme);
                this.updateThemeToggle(savedTheme);

                window.addEventListener('scroll', () => {
                    const nav = document.getElementById('top-nav');
                    if (window.scrollY > 20) nav.classList.add('scrolled');
                    else nav.classList.remove('scrolled');
                });

                await signInAnonymously(auth);
                setTimeout(() => document.getElementById('loader').classList.add('hidden'), 1500);

                document.getElementById('login-form').onsubmit = (e) => this.handleLogin(e);
                document.getElementById('chat-form').onsubmit = (e) => this.sendChat(e);
                this.showHome();
                window.App = this;
            },

            toggleTheme() {
                const currentTheme = document.body.getAttribute('data-theme');
                const newTheme = currentTheme === 'light' ? 'dark' : 'light';
                document.body.setAttribute('data-theme', newTheme);
                localStorage.setItem('theme', newTheme);
                this.updateThemeToggle(newTheme);
            },

            updateThemeToggle(theme) {
                const sunIcon = document.querySelector('.theme-toggle .fa-sun');
                const moonIcon = document.querySelector('.theme-toggle .fa-moon');
                if (theme === 'light') {
                    sunIcon.style.opacity = '1';
                    moonIcon.style.opacity = '0.5';
                } else {
                    sunIcon.style.opacity = '0.5';
                    moonIcon.style.opacity = '1';
                }
            },

            startClock() {
                setInterval(() => {
                    this.state.portalTime = new Date();
                    const disp = document.getElementById('live-time-disp');
                    if (disp) disp.innerText = this.state.portalTime.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: true });
                }, 1000);
            },

            async handleLogin(e) {
                e.preventDefault();
                const srn = document.getElementById('l-srn').value.toUpperCase();
                const pass = document.getElementById('l-pass').value;
                const btn = e.target.querySelector('button');
                btn.innerText = 'SYNCING NODE...';

                const studentsRef = collection(db, 'artifacts', appId, 'public', 'data', 'students');
                const q = query(studentsRef, where('srn', '==', srn), where('pass', '==', pass));

                onSnapshot(q, (snap) => {
                    if (!snap.empty) {
                        const studentDoc = snap.docs[0];
                        this.state.user = { id: studentDoc.id, ...studentDoc.data() };
                        this.enterPortal();
                    } else {
                        alert("❌ Unauthorized Identify Attempt.");
                        btn.innerText = 'Authorize Session';
                    }
                }, { once: true });
            },

            enterPortal() {
                ui.toggle('view-login', false);
                ui.toggle('view-portal', true);
                ui.toggle('top-nav', false);
                ui.toggle('ticker-bar', true);
                ui.set('u-name-side', this.state.user.name || 'UNIDENTIFIED');
                ui.set('u-srn-side', this.state.user.srn || 'NODE_OFFLINE');
                ui.set('u-avatar', (this.state.user.name ? this.state.user.name[0] : '?'));
                ui.set('disp-name', this.state.user.name || 'UNIDENTIFIED');
                ui.set('disp-details', `${this.state.user.branch || 'EC/CS'} • SEM 5 • ${this.state.user.srn || 'OFFLINE'}`);
                this.sync();
                anime({ targets: '.card', opacity: [0, 1], translateY: [50, 0], duration: 800, delay: anime.stagger(100) });
            },

            sync() {
                const cols = ['projects', 'tasks', 'mentors', 'chats', 'notifications', 'resources'];
                cols.forEach(c => {
                    onSnapshot(collection(db, 'artifacts', appId, 'public', 'data', c), snap => {
                        this.state[c] = snap.docs.map(d => ({ id: d.id, ...d.data() }));
                        this.render();
                    });
                });
                onSnapshot(doc(db, 'artifacts', appId, 'public', 'data', 'students', this.state.user.id), docSnap => {
                    if (docSnap.exists()) {
                        this.state.user = { id: docSnap.id, ...docSnap.data() };
                        this.updateAttUI();
                        if (!document.getElementById('tab-attendance-ledger').classList.contains('hidden')) this.renderAttendanceTab();
                    }
                });
            },

            switchTab(t) {
                document.querySelectorAll('[id^="tab-"]').forEach(el => el.classList.add('hidden'));
                document.querySelectorAll('.sidebar-link').forEach(el => el.classList.remove('active'));
                const tabEl = document.getElementById(`tab-${t}`);
                const navEl = document.getElementById(`nav-${t}`);
                if (tabEl) tabEl.classList.remove('hidden');
                if (navEl) navEl.classList.add('active');
                if (t === 'attendance-ledger') this.renderAttendanceTab();
                if (t === 'public-resources') this.renderResourcesTab();
                if (window.innerWidth < 768) this.toggleSidebar();
                setTimeout(() => {
                    anime({ targets: `#tab-${t} .card, #tab-${t} .task-card, #tab-${t} .proj-dash-grid, #tab-${t} .resource-card`, opacity: [0, 1], translateY: [30, 0], duration: 600, delay: anime.stagger(80) });
                }, 100);
            },

            render() {
                const { user, projects, tasks, mentors } = this.state;
                if (!user) return;

                const mentor = mentors.find(m => m.email === user.mentor);
                ui.set('d-mentor', mentor ? mentor.name : 'SYNC_PENDING');
                ui.set('d-mentor-dept', mentor ? mentor.department : 'Faculty Node Offline');

                const myProjects = projects.filter(p => p.members?.includes(user.name));
                myProjects.forEach((p, index) => { if (!p.id) p.id = `proj${index + 1}`; });

                ui.html('dash-projects-summary', myProjects.map(p => {
                    const points = p.points || [];
                    const approved = points.filter(pt => pt.status === 'approved').length;
                    const total = p.totalPoints || points.length || 0;
                    const score = total > 0 ? Math.round((approved / total) * 100) : 0;
                    return `
                    <div style="background: var(--surface); padding: 18px; border-radius: 24px; border: 1px solid var(--border);">
                        <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 12px;">
                            <div>
                                <p class="info-label" style="margin-bottom:5px;">${p.name || 'Unassigned Track'}</p>
                                <p class="info-value" style="font-size: 1rem;">Team: ${p.teamName || 'Standalone'}</p>
                            </div>
                            <div style="background: ${score >= 80 ? 'rgba(16,185,129,0.15)' : 'rgba(245,158,11,0.15)'}; padding: 8px 16px; border-radius: 40px;">
                                <span style="color: ${score >= 80 ? '#10B981' : '#F59E0B'}; font-weight: 700;">${score}/100</span>
                            </div>
                        </div>
                    </div>`;
                }).join('') || '<p class="info-sub">No research tracks discovered.</p>');

                ui.html('projects-container', myProjects.map(p => {
                    const points = p.points || [];
                    const total = p.totalPoints || points.length || 0;
                    const approved = points.filter(pt => pt.status === 'approved').length;
                    const score = total > 0 ? Math.round((approved / total) * 100) : 0;
                    const cols = Math.min(10, Math.ceil(Math.sqrt(total)) || 10);
                    const teamRes = PROJECT_RESOURCES[p.id] || [];

                    return `
                        <div class="card" style="padding: 35px;">
                            <div class="proj-dash-grid">
                                <div>
                                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 20px; flex-wrap: wrap; gap: 15px;">
                                        <div>
                                            <h3 class="info-value" style="font-size:1.8rem;">${p.name || 'Unassigned Track'}</h3>
                                            <p class="info-sub" style="margin-top: 8px;">Team: ${p.teamName || 'Standalone'}</p>
                                        </div>
                                        <div style="text-align: center;">
                                            <div class="score-display">${score}</div>
                                            <div class="score-label">Cumulative Score</div>
                                        </div>
                                    </div>
                                    <div class="milestone-grid" style="grid-template-columns: repeat(${cols}, 1fr);">
                                        ${Array(total).fill().map((_, i) => `<div class="milestone-node ${points[i]?.status || 'none'}" onclick="App.markPoint('${p.id}', ${i}, '${points[i]?.status || 'none'}')">${i + 1}</div>`).join('')}
                                    </div>
                                    <div class="input-group">
                                        <input type="text" id="p-link-${p.id}" placeholder="Payload Anchor (Git/Drive)" value="${p.driveLink || ''}">
                                        <button onclick="App.submitProj('${p.id}')" class="btn-action">ANCHOR</button>
                                    </div>
                                </div>
                                <div style="border-left: 2px solid var(--border); padding-left: 30px;">
                                    <span class="info-label"><i class="fas fa-file-pdf"></i> Reference Protocol</span>
                                    ${p.pdfUrl ? `
                                        <div class="pdf-viewer-placeholder" onclick="App.openPDF('${p.pdfUrl}', '${p.name} Protocol')">
                                            <i class="fas fa-file-pdf" style="font-size: 3rem; color: var(--primary);"></i>
                                            <p class="info-value" style="font-size: 1rem;">PREVIEW PROTOCOL</p>
                                            <button class="btn-claim" style="padding: 10px 20px; font-size: 10px;">OPEN VIEWER</button>
                                        </div>
                                        <p style="color: var(--success); font-size: 11px; margin-top: 10px; text-align: center;">
                                            <i class="fas fa-check-circle"></i> Protocol Verified: ${p.pdfFileName || 'Active'}
                                        </p>` : `
                                        <div class="pdf-viewer-placeholder" style="cursor: default; opacity: 0.5;">
                                            <i class="fas fa-lock" style="font-size: 3rem; color: var(--text-muted);"></i>
                                            <p class="info-sub">Documentation Pending</p>
                                        </div>`
                        }
                                    
                                    <div style="margin-top: 30px;">
                                        <span class="info-label"><i class="fas fa-folder-open"></i> Team Resources</span>
                                        <div class="resource-grid" style="grid-template-columns: 1fr; margin-top: 15px;">
                                            ${teamRes.map(r => `
                                                <div class="resource-card" onclick="App.openPDF('${r.pdfUrl}', '${r.title}')">
                                                    <div style="display: flex; gap: 15px; align-items: center;">
                                                        <div class="resource-icon" style="width: 40px; height: 40px; font-size: 1.2rem;"><i class="fas fa-file-pdf"></i></div>
                                                        <div style="flex: 1;"><div class="resource-title" style="font-size: 1rem;">${r.title}</div><p class="info-sub" style="font-size: 10px;">${r.uploadedBy}</p></div>
                                                    </div>
                                                </div>`).join('') || '<p class="info-sub">None synced.</p>'}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>`;
                }).join('') || '<p class="info-sub" style="text-align:center; padding:80px;">No tracks synced.</p>');

                ui.html('tasks-list', tasks.filter(t => t.sid === user.srn || t.sid === user.id).map(t => `
                    <div class="task-card" style="border-left-color: ${t.status === 'Done' ? 'var(--success)' : 'var(--warning)'}">
                        <h3 class="info-value" style="font-size:1.2rem;">${t.desc || t.title}</h3>
                        <p class="info-sub">Due: ${t.due || 'TBD'}</p>
                        <div style="margin-top:15px;">${t.status === 'Pending' ? `<button onclick="App.taskAct('${t.id}', 'Accepted')" class="btn-claim" style="width:100%;">ACCEPT</button>` : `<span class="badge-aesthetic">${t.status}</span>`}</div>
                    </div>`).join('') || '<p class="info-sub">Queue clear.</p>');

                ui.html('chat-roster', `<div onclick="App.openChat('admin')" class="chat-list-item active">Admin</div>`);
                this.updateStats();
            },
            renderResourcesTab() {
                if (!this.state.resources) return;

                // Filter resources based on selected category
                const filter = (res) => this.state.currentResourceFilter === 'all' ? res : res.filter(r => r.category === this.state.currentResourceFilter);

                // Categorize resources
                const academic = this.state.resources.filter(r => ['syllabus', 'notes', 'pastpapers'].includes(r.category));
                const technical = this.state.resources.filter(r => r.category === 'reference');
                const research = this.state.resources.filter(r => r.category === 'research');

                // Render categorized resources
                ui.html('academic-resources', filter(academic).map(r => this.createResourceCard(r)).join('') || '<p class="info-sub">No academic resources available.</p>');
                ui.html('technical-resources', filter(technical).map(r => this.createResourceCard(r)).join('') || '<p class="info-sub">No technical resources available.</p>');
                ui.html('research-resources', filter(research).map(r => this.createResourceCard(r)).join('') || '<p class="info-sub">No research resources available.</p>');
            },
            createResourceCard(r) {
                return `<div class="resource-card" onclick="App.openPDF('${r.pdfUrl}', '${r.title}')">
                    <div class="resource-icon"><i class="fas fa-file-pdf"></i></div>
                    <div class="resource-title">${r.title}</div>
                    <div class="resource-description">${r.description || ''}</div>
                    <div class="resource-meta">
                        <span class="resource-tag">${r.category}</span> 
                        <span class="resource-uploader">
                            <i class="fas fa-user"></i> 
                            <span>${r.uploadedBy}</span>
                        </span>
                    </div>
                    <div style="font-size: 10px; color: var(--text-muted); margin-top: 5px;">
                        <i class="fas fa-calendar"></i> ${r.uploadedAt}
                    </div>
                </div>`;
            },

            filterResources(c) {
                this.state.currentResourceFilter = c;
                this.renderResourcesTab();

                // Update button styles
                document.querySelectorAll('[id^="filter-"]').forEach(btn => {
                    btn.style.background = 'var(--surface)';
                    btn.style.color = 'var(--text)';
                });
                const activeBtn = document.getElementById(`filter-${c}`);
                if (activeBtn) {
                    activeBtn.style.background = 'var(--primary)';
                    activeBtn.style.color = '#fff';
                }
            },

            async openPDF(url, title) {
                const modal = document.getElementById('pdf-modal');
                document.getElementById('modal-title').textContent = title;
                modal.classList.add('active');
                document.body.style.overflow = 'hidden';
                document.getElementById('pdf-loading').style.display = 'block';

                try {
                    const loadingTask = pdfjsLib.getDocument(url);
                    this.state.pdfDoc = await loadingTask.promise;
                    this.state.totalPages = this.state.pdfDoc.numPages;
                    this.state.currentPage = 1;
                    document.getElementById('page-count').textContent = this.state.totalPages;
                    await this.renderPDFPage();
                } catch (e) {
                    alert("Error loading protocol. The PDF file might be unavailable.");
                }
                document.getElementById('pdf-loading').style.display = 'none';
            },

            async renderPDFPage() {
                if (!this.state.pdfDoc) return;
                const canvas = document.getElementById('pdf-canvas');
                const ctx = canvas.getContext('2d');
                const page = await this.state.pdfDoc.getPage(this.state.currentPage);
                const viewport = page.getViewport({ scale: this.state.scale });
                canvas.height = viewport.height;
                canvas.width = viewport.width;
                await page.render({ canvasContext: ctx, viewport: viewport }).promise;
                document.getElementById('page-num').textContent = this.state.currentPage;
                document.getElementById('prev-page').disabled = this.state.currentPage <= 1;
                document.getElementById('next-page').disabled = this.state.currentPage >= this.state.totalPages;
            },

            nextPage() { if (this.state.currentPage < this.state.totalPages) { this.state.currentPage++; this.renderPDFPage(); } },
            prevPage() { if (this.state.currentPage > 1) { this.state.currentPage--; this.renderPDFPage(); } },
            zoomIn() { this.state.scale += 0.25; this.renderPDFPage(); },
            zoomOut() { if (this.state.scale > 0.5) { this.state.scale -= 0.25; this.renderPDFPage(); } },
            fitToWidth() { const container = document.getElementById('pdf-canvas-container'); this.state.scale = (container.clientWidth - 40) / 600; this.renderPDFPage(); },
            closePDFModal() { document.getElementById('pdf-modal').classList.remove('active'); document.body.style.overflow = ''; },

            async markPoint(pid, idx, curr) {
                if (curr !== 'none') return;
                const p = this.state.projects.find(x => x.id === pid);
                const points = [...p.points];
                points[idx] = { status: 'pending' };
                await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'projects', pid), { points });
            },

            async submitProj(id) {
                const link = document.getElementById(`p-link-${id}`).value;
                await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'projects', id), { driveLink: link });
                alert("🚀 Payload Anchored.");
            },

            async markLog(type) {
                const time = this.state.portalTime.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', hour12: true });
                const dateKey = this.state.portalTime.toISOString().split('T')[0];
                const logs = this.state.user.logs || {};
                if (!logs[dateKey]) logs[dateKey] = {};
                logs[dateKey][type.toLowerCase()] = time;
                await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'students', this.state.user.id), { att: 'pending', logs, time, lastAction: type });
                alert(`${type} synchronized.`);
            },

            updateAttUI() {
                const s = this.state.user.att || 'offline';
                ui.html('att-badge', `<span class="badge-aesthetic" style="background:var(--surface); color:var(--primary); border:1px solid var(--primary);">${s.toUpperCase()}</span>`);
            },

            updateStats() {
                const ctx = document.getElementById('dashRing');
                if (!ctx) return;
                const missed = this.state.user.absentCount || 0;
                const perc = Math.max(0, Math.round(((26 - missed) / 26) * 100));
                if (window.chartNode) window.chartNode.destroy();
                window.chartNode = new Chart(ctx, { type: 'doughnut', data: { datasets: [{ data: [perc, 100 - perc], backgroundColor: ['#6366F1', 'var(--border)'], borderWidth: 0 }] }, options: { cutout: '82%', plugins: { legend: { display: false } }, responsive: true } });
                ui.set('dash-perc', perc + '%');
                ui.set('verified-count', perc + '%');
                document.getElementById('bar-att').style.width = perc + '%';
            },

            renderAttendanceTab() {
                const logs = this.state.user.logs || {};
                const year = 2026, month = 1;
                const firstDay = new Date(year, month, 1).getDay();
                const days = new Date(year, month + 1, 0).getDate();
                let h = ['S', 'M', 'T', 'W', 'T', 'F', 'S'].map(d => `<div class="calendar-header">${d}</div>`).join('');
                for (let i = 0; i < firstDay; i++) h += `<div></div>`;
                for (let i = 1; i <= days; i++) {
                    const dk = `${year}-02-${String(i).padStart(2, '0')}`;
                    h += `<div class="calendar-cell ${i === 26 ? 'today' : ''}">${i}${logs[dk] ? '<span class="status-dot status-present"></span>' : ''}</div>`;
                }
                ui.html('att-calendar', h);
                ui.html('daily-log-list', Object.keys(logs).sort().reverse().map(d => `<div class="card" style="padding:15px; margin-bottom:10px;">${d}: ${logs[d].in || '--'} to ${logs[d].out || '--'}</div>`).join(''));
            },

            openChat(id) { this.state.activeChat = id; this.renderSyncWindow(); },
            renderSyncWindow() { ui.html('chat-window', '<p class="info-sub" style="text-align:center;">Secure channel established.</p>'); },
            async sendChat(e) { e.preventDefault(); document.getElementById('chat-input').value = ''; },
            toggleSidebar() { document.getElementById('app-sidebar').classList.toggle('active'); },
            showHome() { ui.toggle('view-home', true); ui.toggle('top-nav', true); ui.toggle('view-login', false); ui.toggle('view-portal', false); },
            showLogin() { ui.toggle('view-home', false); ui.toggle('top-nav', true); ui.toggle('view-login', true); },

            init3D() {
                const scene = new THREE.Scene();
                const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
                const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
                renderer.setSize(window.innerWidth, window.innerHeight);
                document.getElementById('canvas-container').appendChild(renderer.domElement);
                const bubbles = [];
                for (let i = 0; i < 50; i++) {
                    const b = new THREE.Mesh(new THREE.SphereGeometry(0.6, 32, 32), new THREE.MeshPhongMaterial({ color: 0x6366F1, transparent: true, opacity: 0.12 }));
                    b.position.set((Math.random() - 0.5) * 180, (Math.random() - 0.5) * 180, (Math.random() - 0.5) * 180);
                    b.userData.v = new THREE.Vector3((Math.random() - 0.5) * 0.012, (Math.random() - 0.5) * 0.012, (Math.random() - 0.5) * 0.012);
                    scene.add(b); bubbles.push(b);
                }
                scene.add(new THREE.DirectionalLight(0xffffff, 0.8));
                scene.add(new THREE.AmbientLight(0x404060));
                camera.position.z = 90;
                const animate = () => {
                    requestAnimationFrame(animate);
                    bubbles.forEach(b => {
                        b.position.add(b.userData.v);
                        if (Math.abs(b.position.x) > 90) b.userData.v.x *= -1;
                        if (Math.abs(b.position.y) > 90) b.userData.v.y *= -1;
                        if (Math.abs(b.position.z) > 90) b.userData.v.z *= -1;
                    });
                    renderer.render(scene, camera);
                };
                animate();
            }
        };

        window.onload = () => App.init();
    </script>
</body>

</html>
